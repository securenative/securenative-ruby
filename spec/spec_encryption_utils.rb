# frozen_string_literal: true

require 'utils/encryption_utils'
require 'rspec'

RSpec.describe EncryptionUtils do
  it 'encrypts' do
    secret_key = 'B00C42DAD33EAC6F6572DA756EA4915349C0A4F6'
    payload = '{"cid":"198a41ff-a10f-4cda-a2f3-a9ca80c0703b","vi":"148a42ff-b40f-4cda-a2f3-a8ca80c0703b","fp":"6d8cabd95987f8318b1fe01593d5c2a5.24700f9f1986800ab4fcc880530dd0ed"}'
    result = EncryptionUtils.encrypt(payload, secret_key)

    expect(result).not_to be_nil
  end

  it 'decrypts' do
    secret_key = 'B00C42DAD33EAC6F6572DA756EA4915349C0A4F6'
    encrypted_payload = '56463564485361554e70763250546e334954565667673d3d246949482f446b72352f6b31316a63466d4c515339703631754b6e54557854546e4a554433634b67744641712f44647356386569636f6a322b4c55354d0a4c6b72504d37464c6f5746632f614f644b542f38585346374566515954355859326a386e576a4439717a7a6a4269744363522f79386851522b7067640a2f67307a6e3264385a5130705a6d44356f4a50396e3236764133635144387379586d6835377475626452783165425976764b6b756952746b79544e350a58477552522f7051706c5a3838646b6a4f44753959626332697a723433564b6b72496943624d584f707770456355316d61662f7256706b3d'
    cid = '198a41ff-a10f-4cda-a2f3-a9ca80c0703b'
    fp = '6d8cabd95987f8318b1fe01593d5c2a5.24700f9f1986800ab4fcc880530dd0ed'

    result = EncryptionUtils.decrypt(encrypted_payload, secret_key)

    expect(result.cid).to eq(cid)
    expect(result.fp).to eq(fp)
  end
end
